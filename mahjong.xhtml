<?xml version='1.0'?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<script type='text/javascript'>
<![CDATA[

var SVGNS = "http://www.w3.org/2000/svg";

var svgdoc = null;
var svgwin = null;

var global_id = 0;

function Board() {
};

Board.prototype.defs = new Array(
    'TILE_1',
    'TILE_1_SEL',
    'TILE_2',
    'TILE_2_SEL',
    'TILE_3',
    'TILE_3_SEL',
    'TILE_4',
    'TILE_4_SEL'
);

Board.prototype.tiles = new Array(
        'CHARACTER_1', 
        'CHARACTER_2', 
        'CHARACTER_3', 
        'CHARACTER_4', 
        'CHARACTER_5',
        'CHARACTER_6',
        'CHARACTER_7',
        'CHARACTER_8',
        'CHARACTER_9',
        'ROD_1',
        'ROD_2',
        'ROD_3',
        'ROD_4',
        'ROD_5',
        'ROD_6',
        'ROD_7',
        'ROD_8',
        'ROD_9',
        'BAMBOO_1',
        'BAMBOO_2',
        'BAMBOO_3',
        'BAMBOO_4',
        'BAMBOO_5',
        'BAMBOO_6',
        'BAMBOO_7',
        'BAMBOO_8',
        'BAMBOO_9',
        'SEASON_1',
        'SEASON_2',
        'SEASON_3',
        'SEASON_4',
        'DRAGON_1',
        'DRAGON_2',
        'DRAGON_3',
        'FLOWER_1',
        'FLOWER_2',
        'FLOWER_3',
        'FLOWER_4',
        'WIND_1',
        'WIND_2',
        'WIND_3',
        'WIND_4'
    );

Board.prototype.board = null;

Board.prototype.init = function() {
    var i, tlen;
    var x=0, y=0;

    this.board = document.getElementById('hgameboard');

    for (i=1, tlen=this.tiles.length; i<=tlen && i<12; i++) {
        var new_x = (i*20)-500;
        var new_y = (i*100)-500;
        var e = this.get_tile(this.tiles[i-1]);
        e.setAttribute('transform', 'translate('+new_x+', '+new_y+')');
        var u = this.create_use();
        u.setAttribute('transform', 'translate('+new_x+', '+new_y+')');
        this.board.appendChild(u);
        //e.appendChild(this.create_use());
        /*
        if (i==1) {
            var bg = this.get_bg();
            bg.setAttribute('transform', 'translate('+new_x+', '+new_y+')');
            this.board.appendChild(bg);
        }
        */
        //var c3 = svgdoc.getElementById(tiles[i-1]);
        //c3.setAttribute('fill', 'black');
        // FIXME: find out tile width dynamically
        //var xpos = 100; //+(20*i);
        //c3.setAttribute('cx', xpos);
        //c3.setAttribute('transform', 'translate('+xpos+')');
        //var p1 = c3.cloneNode(true);
        //p1.setAttribute('transform', 'translate(0, -556)');
  
        //var newbg = background.cloneNode(true);
        //newbg.setAttribute('x', 68*x);
        //newbg.setAttribute('y', 100*y);
        //newbg.onclick = function () { alert('bgclick'); };
  
        if (i != 0 && (i % 9) == 0) {
          y += 1;
          //ytrans += 50;
          x = 0;
        } else {
          x += 1;
        }
    }
    this.copy_defs();
}

Board.prototype.get_def = function () {
    return d;
}

Board.prototype.create_use = function () {
    use = document.createElementNS(SVGNS, "use");
    use.setAttribute("xlink:href", '#TILE_2');
    use.setAttribute("x", 0);
    use.setAttribute("y", 0);
    return use;
}

Board.prototype.copy_defs = function () {
    // create def
    var def_sect = document.getElementById('bg_elems');
    for (var i=0; i<this.defs.length; i++) {
        var d = svgdoc.getElementById(this.defs[i]);
        def_sect.appendChild(d);
    }
}

Board.prototype.get_tile = function (tile_name) {
    var origtile = svgdoc.getElementById(tile_name);
    var t1 = origtile.cloneNode(true);
    //t1.setAttribute('transform', 'translate(0, -556)');

    //var background = svgdoc.getElementById('rect_back').cloneNode(true);
    //var selected = svgdoc.getElementById('rect_selected').cloneNode(true);
    //var background = svgdoc.getElementById('TILE_2').cloneNode(true);
    //var selected = svgdoc.getElementById('TILE_2_SEL').cloneNode(true);

    //var newbg = background.cloneNode(true);
    //newbg.setAttribute('id', 'gg'+global_id);
    //newbg.setAttribute('x', 0);
    //newbg.setAttribute('y', 0);

    global_id += 1;
    //newbg.setAttribute('x', 68*x);
    //newbg.setAttribute('y', 100*y);
    //newbg.onclick = function () { alert('bgclick'); };

    t1.onclick = function () { alert('tile click'); };

    //if (global_id == 1) {
    //    t1.appendChild(newbg);
    //}
    //t1.lastElementChild.appendChild(newbg);
    this.board.appendChild(t1);

    return t1;
}

Board.prototype.get_bg = function () {
    var background = svgdoc.getElementById('TILE_2').cloneNode(true);
    return background;
}

function init() {
  // see http://w3.org/TR/SVG11/struct.html#InterfaceGetSVGDocument
  var embed = document.getElementById('tileset');
  try {
    svgdoc = embed.getSVGDocument();
  } catch(exception) {
    alert('getSVGDocument interface not available. Try some other browser.');
  }
  
  if (svgdoc && svgdoc.defaultView) {
    svgwin = svgdoc.defaultView; 
  }

  b = new Board();
  b.init();
}

]]>
</script>
</head>
<body onload="javascript:init();">

<embed id="tileset" src="traditional.svg" width="0" height="0" type="image/svg+xml"></embed>

<!-- viewBox="0 0 100 100"  -->
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1200 1200" style="width:100%; height:100%; position:absolute; top:0; left:0; z-index:-1;" id="hgameboard">
  <defs id="bg_elems"></defs>
</svg>

</body>
</html>
